<html>
<body>
<p>Comet, yah!</p>

<div id="writer"></div>
<div id="evaler"></div>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/mootools/1.3.2/mootools-yui-compressed.js"></script>
<script type="text/javascript">
var req;
function startstream() {
    req = new Request({
      url: "/server_push?" + Math.floor(Math.random() * 1024)
    });
    req.send();
}

var lastmsglength = 0;
window.addEvent('domready', function () {
    startstream();
    (function () {
       var content = req.xhr.responseText.substr(lastmsglength, req.xhr.responseText.length);
       lastmsglength = req.xhr.responseText.length;
       if (content.indexOf("script") > -1) {
         var js = content.split("<script type=\"text/javascript\">").pop().split("</" + "script>").shift();
         eval(js);
       }
    }).periodical(1000);
});
</script>
</body>
</html>
